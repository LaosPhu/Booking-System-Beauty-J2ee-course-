<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/responsive.css">
  <link rel="stylesheet" href="/css/adminbooking.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Add Bootstrap JS (Optional: Popper.js is required for certain Bootstrap components like modals) -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

  <style>

    /* Custom styles for the admin dashboard layout */
    body {
        margin: 0;
        padding: 0;
        background-color: #f4f6f9; /* Light background */
    }
    .admin-container {
        display: flex;
        min-height: 100vh;
    }

    /* Sidebar Styles */
    .admin-sidebar {
        background-color: #30303d; /* Dark sidebar */
        color: white;
        width: 250px; /* Fixed width */
        padding-top: 20px;
        transition: width 0.3s ease; /* Smooth transition for collapsing */
        position: fixed; /* Fixed position */
        height: 100%;
        overflow-y: auto; /* Scrollable content */
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        z-index: 10; /* Ensure sidebar is above other elements */
    }

    .admin-sidebar .logo {
        text-align: center;
        margin-bottom: 20px;
    }
    .admin-sidebar .logo a{
      color: white;
      font-size: 24px;
      font-weight: bold;
      text-decoration: none;
    }

    .admin-sidebar .nav-item {
        padding: 10px 20px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .admin-sidebar .nav-item:hover {
        background-color: #444451; /* Darker hover */
    }

    .admin-sidebar .nav-item.active {
        background-color: #4a148c; /* Active color */
    }

    .admin-sidebar .nav-link {
        color: white;
        text-decoration: none;
        display: flex; /* Use flexbox for icon alignment */
        align-items: center; /* Vertically center icon and text */
        gap: 10px; /* Space between icon and text */
    }

    .admin-sidebar .nav-link i {
        margin-right: 5px; /* Space between icon and text */
        width: 20px; /* Fixed width for icons */
        text-align: center;
    }

    /* Main Content Styles */
    .main-content {
        flex: 1; /* Take up remaining space */
        padding: 20px;
        padding-left: 270px; /* Leave space for the sidebar */
        transition: padding-left 0.3s ease; /* Smooth transition for content shift */
        min-height: 100vh;
        background-color: #f9f9f9;
    }

    .content-wrapper {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Responsive adjustments for smaller screens */
    @media (max-width: 768px) { /* Medium screens and below (tablets) */
        .admin-sidebar {
            width: 100%; /* Full width on small screens */
            position: fixed; /* Make it fixed */
            top: 0;
            left: 0;
            z-index: 1000; /* High z-index to be on top */
            transform: translateX(-100%); /* Start off-screen */
            transition: transform 0.3s ease; /* Smooth slide-in */
            height: 100vh;
            overflow-y: auto;
        }
        .admin-sidebar.show {
            transform: translateX(0); /* Slide in when show class is added */
        }
        .main-content {
            padding-left: 20px; /* Reduce padding-left on small screens */
        }
        .menu-toggle {
            display: block; /* Show menu toggle button */
        }
    }

    /* Menu Toggle Button */
    .menu-toggle {
        position: fixed; /* Fix button to the top left */
        top: 10px;
        left: 10px;
        background-color: #4a148c;
        color: white;
        border: none;
        padding: 10px;
        padding-left: 15px;
        padding-right: 15px;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1001; /* Sit on top of everything */
        display: none; /* Hide by default on larger screens */
        align-items: center;
        gap: 5px;
    }

    .menu-toggle i{
        font-size: 18px;
    }
    .hidden{
      display: none;
    }


    .table-wrapper {
    max-height: 500px; /* Gi·ªõi h·∫°n chi·ªÅu cao c·ªßa b·∫£ng (kho·∫£ng 6 d√≤ng) */
    overflow-y: auto;  /* Th√™m thanh cu·ªôn d·ªçc */
    -webkit-overflow-scrolling: touch; /* Cu·ªôn m∆∞·ª£t m√† tr√™n thi·∫øt b·ªã di ƒë·ªông */
}

    .table {
        width: 100%;  /* ƒê·∫£m b·∫£o b·∫£ng chi·∫øm to√†n b·ªô chi·ªÅu r·ªông */
    }

    .table thead, table tbody tr {
        width: 100%;
        table-layout: fixed;
    }
    .sticky-header th {
        position: sticky;
        top: 0;
        background-color: #343a40; /* ƒê·∫£m b·∫£o ti√™u ƒë·ªÅ c√≥ n·ªÅn m√†u */
        z-index: 1;
    }


}

  </style>
</head>
<body>
<div class="admin-container">
  <aside class="admin-sidebar" id="admin-sidebar">
    <div class="logo">
      <a href="#">Bliss Admin</a>
    </div>
    <nav class="nav-menu">
      <div class="nav-item active">
        <a href="/admin" class="nav-link">
          <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="/admin-user" class="nav-link">
          <i class="fas fa-users"></i> <span>Users</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="/admin-service" class="nav-link">
          <i class="fas fa-spa"></i> <span>Services</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="/admin-booking" class="nav-link">
          <i class="fas fa-calendar-alt"></i> <span>Bookings</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="#" class="nav-link">
          <i class="fas fa-comments"></i> <span>Reviews</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="#" class="nav-link">
          <i class="fas fa-chart-bar"></i> <span>Reports</span>
        </a>
      </div>
      <div class="nav-item">
        <a  onclick="logout()" href="#" class="nav-link">
          <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
        </a>
      </div>
    </nav>
  </aside>
  <div class="main-content">
    <div class="content-wrapper">
      <h2 class="mb-4">Dashboard - Bliss Admin</h2>

      <div class="row text-white mb-4">
        <div class="col-md-3">
          <div class="card bg-primary">
            <div class="card-body">
              <h5 class="card-title">Kh√°ch h√†ng</h5>
              <p class="card-text fs-4" id="total-customers"></p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success">
            <div class="card-body">
              <h5 class="card-title">D·ªãch v·ª•</h5>
              <p class="card-text fs-4" id="total-services"></p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning">
            <div class="card-body">
              <h5 class="card-title">L·ªãch h·∫πn h√¥m nay</h5>
              <p class="card-text fs-4" id="today-bookings">8</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-danger">
            <div class="card-body">
              <h5 class="card-title">Doanh thu h√¥m nay</h5>
              <p class="card-text fs-4" id="today-revenue">2.500.000ƒë</p>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">Doanh thu theo ng√†y</div>
        <div class="card-body">
          <canvas id="revenueChart" height="100"></canvas>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">L·ªãch h·∫πn h√¥m nay</div>
        <div class="card-body table-wrapper">
          <table class="table table-bordered sticky-header">
            <thead>
            <tr>
              <th>Kh√°ch h√†ng</th>
              <th>D·ªãch v·ª•</th>
              <th>Th·ªùi gian</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td>Nguy·ªÖn Th·∫£o</td>
              <td>Massage m·∫∑t</td>
              <td>10:00</td>
              <td><span class="badge bg-info">Ch·ªù x√°c nh·∫≠n</span></td>
            </tr>
            <tr>
              <td>Tr·∫ßn An</td>
              <td>G·ªôi ƒë·∫ßu d∆∞·ª°ng sinh</td>
              <td>13:30</td>
              <td><span class="badge bg-success">ƒê√£ x√°c nh·∫≠n</span></td>
            </tr>
            <!-- Th√™m c√°c d√≤ng kh√°c ·ªü ƒë√¢y -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Th√¥ng b√°o</div>
        <div class="card-body">
          <ul class="list-group">
            <li class="list-group-item">üí° L·ªãch h·∫πn c·ªßa Nguy·ªÖn Th·∫£o s·∫Ω di·ªÖn ra trong 1 gi·ªù.</li>
            <li class="list-group-item">‚ö†Ô∏è D·ªãch v·ª• "ChƒÉm s√≥c da chuy√™n s√¢u" c√≤n √≠t l∆∞·ª£t.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('revenueChart').getContext('2d');
    const revenueChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'],
        datasets: [{
          label: 'Doanh thu (VNƒê)',
          data: [1500000, 1800000, 1200000, 2000000, 2500000, 3000000, 1000000],
          backgroundColor: '#4a148c'
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return value.toLocaleString('vi-VN') + 'ƒë';
              }
            }
          }
        }
      }
    });
  </script>
</div>
<script>
  // Khi trang t·∫£i xong th√¨ g·ªçi API ƒë·∫øm s·ªë user theo role
  document.addEventListener("DOMContentLoaded", function() {
    fetch('/api/user/count-by-role')
      .then(response => response.json())
      .then(data => {
        // data.customer l√† s·ªë l∆∞·ª£ng kh√°ch h√†ng
        const totalCustomersElement = document.getElementById('total-customers');
        if (totalCustomersElement && data.customer !== undefined) {
          totalCustomersElement.textContent = data.customer;
        }
      })
      .catch(error => {
        console.error('L·ªói khi l·∫•y s·ªë l∆∞·ª£ng kh√°ch h√†ng:', error);
      });
  });
  // G·ªçi API ƒë·ªÉ l·∫•y s·ªë l∆∞·ª£ng d·ªãch v·ª•
  fetch('/api/service/count')
    .then(response => response.json())
    .then(data => {
      const totalServices = data.count;
      document.getElementById('total-services').textContent = totalServices;
    })
    .catch(error => {
      console.error('L·ªói khi l·∫•y s·ªë l∆∞·ª£ng d·ªãch v·ª•:', error);
      document.getElementById('total-services').textContent = 'L·ªói';
    });
  fetch('/api/booking/count')
  .then(response => {
    if (!response.ok) throw new Error('Network response was not ok');
    return response.json();
  })
  .then(data => {
    document.getElementById('today-bookings').textContent = data.count;
  })
  .catch(error => {
    console.error('L·ªói khi l·∫•y s·ªë l·ªãch h·∫πn h√¥m nay:', error);
    document.getElementById('today-bookings').textContent = 'L·ªói';
  });
</script>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
</body>
</html>
